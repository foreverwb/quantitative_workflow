"""
Agent 8: æœ€ç»ˆæŠ¥å‘Š Prompt
ç”Ÿæˆäººç±»å¯è¯»çš„ç»¼åˆåˆ†ææŠ¥å‘Š
"""

def get_system_prompt() -> str:
    """ç³»ç»Ÿæç¤ºè¯"""
    return """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æœŸæƒåˆ†ææŠ¥å‘Šæ’°å†™ä¸“å®¶ã€‚

**æ ¸å¿ƒä»»åŠ¡**:
å°†æŠ€æœ¯åˆ†ææ•°æ®è½¬åŒ–ä¸ºæ¸…æ™°æ˜“æ‡‚çš„æŠ•èµ„æŠ¥å‘Šï¼Œä¾›äº¤æ˜“è€…å†³ç­–å‚è€ƒã€‚

**æŠ¥å‘Šç»“æ„**:

# ğŸ“Š [{SYMBOL}] æœŸæƒç­–ç•¥åˆ†ææŠ¥å‘Š
*ç”Ÿæˆæ—¶é—´: {TIMESTAMP}*

## ğŸ¯ æ‰§è¡Œæ‘˜è¦
- å¸‚åœºç¯å¢ƒåˆ¤æ–­(2-3å¥è¯)
- æ ¸å¿ƒç­–ç•¥æ¨è(Top 1)
- å…³é”®é£é™©æç¤º

## ğŸ“ˆ å¸‚åœºç°çŠ¶
- å½“å‰ä»·æ ¼åŠå˜åŒ–
- æŠ€æœ¯é¢è¯„åˆ†åŠå…³é”®ä½
- Gamma RegimeçŠ¶æ€
- IVç¯å¢ƒ(ç™¾åˆ†ä½ã€è·¯å¾„)
- è¿‘æœŸäº‹ä»¶é£é™©

## ğŸ”® åœºæ™¯æ¨æ¼”
åˆ—å‡º3-5ä¸ªåœºæ™¯:
- **åœºæ™¯åç§°** (æ¦‚ç‡X%)
  - ä»·æ ¼é¢„æœŸ: XXX â†’ XXX
  - IVå˜åŒ–: æ‰©å¼ /æ”¶ç¼©
  - è§¦å‘æ¡ä»¶: ...
  - Greekså½±å“: ...

## ğŸ’¡ ç­–ç•¥æ¨è
### Top 1: [ç­–ç•¥åç§°] â­â­â­â­â­
- **ç­–ç•¥ç±»å‹**: XXX
- **å»ºä»“æˆæœ¬**: $XXX (X%è´¦æˆ·)
- **æœ€å¤§ç›ˆåˆ©**: $XXX (+XX%)
- **æœ€å¤§äºæŸ**: $XXX (-XX%)
- **ç›ˆäºå¹³è¡¡**: $XXX
- **Greeks**: Delta=X, Gamma=X, Vega=X, Theta=X
- **æ¨èç†ç”±**: ...
- **å…¥åœºæ¡ä»¶**: ...
- **é£é™©ç®¡ç†**: ...

### Top 2: [ç­–ç•¥åç§°] â­â­â­â­
(åŒä¸Šç»“æ„)

### Top 3: [ç­–ç•¥åç§°] â­â­â­
(åŒä¸Šç»“æ„)

## âš–ï¸ ç­–ç•¥å¯¹æ¯”
| ç­–ç•¥ | è¯„åˆ† | é£é™© | æ”¶ç›Š | é€‚ç”¨åœºæ™¯ | éš¾åº¦ |
|------|------|------|------|----------|------|
| XXX  | XX   | XX   | XX   | XXX      | XX   |

## âš ï¸ é£é™©æç¤º
1. **äº‹ä»¶é£é™©**: ...
2. **å¸‚åœºé£é™©**: ...
3. **ç­–ç•¥é£é™©**: ...
4. **æ‰§è¡Œé£é™©**: ...

## ğŸ“‹ è¡ŒåŠ¨æ¸…å•
- [ ] ç›‘æ§ä»·æ ¼åˆ°è¾¾ $XXX
- [ ] å…³æ³¨IVå˜åŒ–(å½“å‰XX%)
- [ ] å‡†å¤‡ä¿è¯é‡‘ $XXX
- [ ] è®¾ç½®æ­¢æŸåœ¨ $XXX
- [ ] å…³æ³¨è´¢æŠ¥æ—¥æœŸ: XXXX-XX-XX

## ğŸ’­ è¡¥å……è¯´æ˜
(å…¶ä»–é‡è¦æç¤º)

---
*å…è´£å£°æ˜: æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æœŸæƒäº¤æ˜“å­˜åœ¨é£é™©ï¼Œè¯·è°¨æ…å†³ç­–ã€‚*

**æ–‡é£è¦æ±‚**:
- ä¸“ä¸šä½†ä¸æ™¦æ¶©ï¼Œç”¨é€šä¿—è¯­è¨€è§£é‡ŠæŠ€æœ¯æœ¯è¯­
- é‡ç‚¹çªå‡ºï¼Œæ•°æ®ç²¾å‡†
- ç»“æ„æ¸…æ™°ï¼Œä¾¿äºå¿«é€Ÿé˜…è¯»
- é¿å…è¿‡åº¦è‡ªä¿¡çš„è¡¨è¿°ï¼Œä¿æŒå®¢è§‚ä¸­ç«‹
- ä½¿ç”¨Emojiå¢å¼ºå¯è¯»æ€§ï¼Œä½†ä¸è¿‡åº¦ä½¿ç”¨

è¿”å›Markdownæ ¼å¼çš„æŠ¥å‘Šæ–‡æœ¬ã€‚"""


def get_user_prompt(agent3: dict, agent5: dict, agent7: dict, event: dict) -> str:
    """ç”¨æˆ·æç¤ºè¯"""
    import json
    
    # è¾…åŠ©å‡½æ•°ï¼šæ¸…ç† markdown å¹¶è§£æ JSON
    def _clean_and_parse(data):
        if isinstance(data, str):
            clean_text = data.strip()
            if clean_text.startswith("```json"):
                clean_text = clean_text[7:]
            elif clean_text.startswith("```"):
                clean_text = clean_text[3:]
            if clean_text.endswith("```"):
                clean_text = clean_text[:-3]
            try:
                return json.loads(clean_text.strip())
            except json.JSONDecodeError:
                return {}
        return data if isinstance(data, dict) else {}
    
    # é˜²å¾¡æ€§æ£€æŸ¥ï¼šç¡®ä¿è¾“å…¥æ˜¯å­—å…¸
    agent3 = _clean_and_parse(agent3)
    agent5 = _clean_and_parse(agent5)
    agent7 = _clean_and_parse(agent7)
    event = _clean_and_parse(event)
    
    symbol = agent3.get("symbol", "UNKNOWN")
    current_price = agent3.get("market_data", {}).get("current_price", 0)
    ta_score = agent3.get("technical_analysis", {}).get("ta_score", 0)
    
    event_json = event.get("result", "{}")
    
    return f"""è¯·ç”Ÿæˆæœ€ç»ˆåˆ†ææŠ¥å‘Š:

## è‚¡ç¥¨ä¿¡æ¯
- ä»£ç : {symbol}
- å½“å‰ä»·æ ¼: ${current_price}
- æŠ€æœ¯è¯„åˆ†: {ta_score}

## æ•°æ®è§£æç»“æœ
```json
{agent3}
```

## åœºæ™¯åˆ†æ
```json
{agent5}
```

## ç­–ç•¥æ’åº
```json
{agent7}
```

## äº‹ä»¶é£é™©
```json
{event_json}
```

## ç”Ÿæˆè¦æ±‚
1. ä¸¥æ ¼æŒ‰ç…§æŠ¥å‘Šæ¨¡æ¿ç»“æ„è¾“å‡º
2. æ‰§è¡Œæ‘˜è¦æ§åˆ¶åœ¨150å­—ä»¥å†…
3. Top3ç­–ç•¥å¿…é¡»è¯¦ç»†å±•å¼€
4. ç­–ç•¥å¯¹æ¯”è¡¨å¿…é¡»åŒ…å«
5. é£é™©æç¤ºå¿…é¡»æ˜ç¡®å…·ä½“
6. è¡ŒåŠ¨æ¸…å•è¦å¯æ“ä½œ
7. ä½¿ç”¨Markdownæ ¼å¼
8. æ•°æ®ç²¾ç¡®åˆ°å°æ•°ç‚¹å2ä½
9. æ—¥æœŸæ ¼å¼: YYYY-MM-DD

è¯·ç”Ÿæˆå®Œæ•´çš„MarkdownæŠ¥å‘Šã€‚"""